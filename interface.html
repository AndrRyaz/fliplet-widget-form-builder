<div id="app" class="is-loading">
  <div class="col-sm-12 loading-message">
    <br />
    <p class="alert alert-warning">
      Loading the form builder... Please wait
    </p>
    <div class="progress">
      <div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%"></div>
    </div>
  </div>
  <main>
    <header>
      <p>Configure your form</p>
      <a id="help_tip" href="#">Need help?</a>
    </header>
    <section v-if="chooseTemplate" class="col-sm-12 choose-template">
      <br />
      <label class="control-label">Step 1. Choose your form template</label>
      <p>Select a template to load a new form.</p>
      <select class="form-control" v-model="settings.templateId">
        <option value="" disabled>-- Select a template</option>
        <option v-for="template in templates" :value="template.id">\{{ template.settings.displayName }}</option>
      </select>

      <hr />

      <label class="control-label">Step 2. Give your form a name</label>
      <p>Maecenas sed diam eget risus varius blandit sit amet non magna.</p>
      <input placeholder="Form name" class="form-control" type="text" v-model="settings.name" :disabled="!settings.templateId" />
    </section>
    <div class="builder" v-else>
      <nav>
        <ul class="nav nav-tabs">
          <li v-bind:class="{ active: section === 'form' }">
            <a href="#" v-on:click.prevent="section = 'form'">Edit form</a>
          </li>
          <li v-bind:class="{ active: section === 'settings' }">
            <a href="#" v-on:click.prevent="section = 'settings'">Settings</a>
          </li>
        </ul>
        <a href="#" class="btn btn-xs btn-primary" v-on:click.prevent="changeTemplate()">Change template</a>
      </nav>

      <div class="content">
        <section class="col-sm-12" v-show="section === 'settings'">
          <h3>Configure form</h3>
          <form>
            <div class="form-group">
              <label for="formName" class="control-label">Form name</label>
              <input id="formName" type="text" v-model="settings.name" class="form-control" />
            </div>
            <div class="form-group" v-if="dataSources.length">
              <label for="selectDataSource" class="control-label">Save results to data source</label>
              <select id="selectDataSource" class="form-control" v-model="settings.dataSourceId" required>
                <option value="" disabled="disabled">Select a data source</option>
                <option v-for="dataSource in dataSources" v-bind:value="dataSource.id">
                  \{{ dataSource.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="formResult" class="control-label">Result HTML message</label>
              <textarea id="formResult" v-model="settings.resultHtml" class="form-control"></textarea>
            </div>
            <div class="form-group">
              <label for="formSubmitLabel" class="control-label">Submit button label</label>
              <input id="formSubmitLabel" type="text" v-model="settings.submitLabel" class="form-control" maxlength="32" />
            </div>
            <div class="form-group">
              <label for="formClearLabel" class="control-label">Clear button label</label>
              <input id="formClearLabel" type="text" v-model="settings.clearLabel" class="form-control" maxlength="32" />
            </div>
          </form>
        </section>

        <div v-show="section === 'form'" class="clearfix">
          <section class="col-sm-6 form-preview">
            <br />
            <input placeholder="Form name" class="form-control" type="text" v-model="settings.name" :disabled="!settings.templateId" />
            <br />
            <div class="row" v-if="!isAddingFields">
              <div class="col-sm-12">
                <a href="#" v-on:click.prevent="isAddingFields = true" class="btn btn-primary btn-xs add-field pull-right">Add field <i class="fa fa-plus"></i></a>
                <br /><br />
              </div>
            </div>

            <form class="form-html" v-sortable="{ group: { name: 'fields', pull: false }, onAdd: onAdd, onUpdate: onSort }">
              <div class="component" :key="field.name" v-for="(field, index) in fields" v-on:click="onFieldClick(field)" v-bind:class="{ editing: field.name === activeFieldId }">
                <component :is="field._type" v-bind="field"></component>
                <div class="overlay-screen"></div>
                <div class="edit-label">
                  <i>Click to edit</i>
                </div>
                <div class="delete-field" href="#" v-on:click.prevent.stop="deleteField(index)"><i class="fa fa-trash"></i></div>
              </div>
            </form>
          </section>

          <section v-if="isAddingFields" class="components-list col-sm-6">
            <h3>Components</h3>
            <form class="form-html" v-sortable="{ sort: false, group: { name: 'fields', pull: 'clone', put: false, revertClone: true } }">
              <div :key="field.name" class="component" v-for="(field, index) in formFields">
                <a href="#" class="add" v-on:click.prevent.stop="addField(fields.length, index)">+</a>
                <component :is="field"></component>
              </div>
            </form>
          </section>
        </div>

        <div class="modal" tabindex="-1" role="dialog" v-bind:class="{ active: !!activeFieldConfigType }">
          <div class="modal-dialog" role="document">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" v-on:click.prevent="closeEdit" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Configure form field</h4>
              </div>
              <div class="modal-body">
                <component :is="activeFieldConfigType" v-bind="activeField"></component>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </main>
</div>
